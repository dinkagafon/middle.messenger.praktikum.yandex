function t(t,e,s,r){Object.defineProperty(t,e,{get:s,set:r,enumerable:!0,configurable:!0})}function e(t){return t&&t.__esModule?t.default:t}var s,r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},n={},a={},i=r.parcelRequiref6c0;null==i&&((i=function(t){if(t in n)return n[t].exports;if(t in a){var e=a[t];delete a[t];var s={id:t,exports:{}};return n[t]=s,e.call(s.exports,s,s.exports),s.exports}var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(t,e){a[t]=e},r.parcelRequiref6c0=i),i.register("j7mty",(function(e,s){var r,n;t(e.exports,"resolve",(function(){return r}),(function(t){return r=t})),t(e.exports,"register",(function(){return n}),(function(t){return n=t}));var a={};n=function(t){for(var e=Object.keys(t),s=0;s<e.length;s++)a[e[s]]=t[e[s]]},r=function(t){var e=a[t];if(null==e)throw new Error("Could not resolve bundle with id "+t);return e}})),i("j7mty").register(JSON.parse('{"chac8":"404.09282a38.js","9fssg":"avatar.d36d91cd.jpg"}'));var o=new Uint8Array(16);function c(){if(!s&&!(s="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return s(o)}var d=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var l=function(t){return"string"==typeof t&&d.test(t)},u=[],p=0;p<256;++p)u.push((p+256).toString(16).substr(1));var h=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=(u[t[e+0]]+u[t[e+1]]+u[t[e+2]]+u[t[e+3]]+"-"+u[t[e+4]]+u[t[e+5]]+"-"+u[t[e+6]]+u[t[e+7]]+"-"+u[t[e+8]]+u[t[e+9]]+"-"+u[t[e+10]]+u[t[e+11]]+u[t[e+12]]+u[t[e+13]]+u[t[e+14]]+u[t[e+15]]).toLowerCase();if(!l(s))throw TypeError("Stringified UUID is invalid");return s};var v=function(t,e,s){var r=(t=t||{}).random||(t.rng||c)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,e){s=s||0;for(var n=0;n<16;++n)e[s+n]=r[n];return e}return h(r)};var f=class{on(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)}off(t,e){if(!this.listeners[t])throw new Error(`Нет события: ${t}`);this.listeners[t]=this.listeners[t].filter((t=>t!==e))}emit(t,...e){if(!this.listeners[t])throw new Error(`Нет события: ${t}`);this.listeners[t].forEach((t=>{t(...e)}))}constructor(){this.listeners={}}};class m{registerEvents(t){t.on(m.EVENTS.INIT,this.init.bind(this)),t.on(m.EVENTS.FLOW_CDM,this.componentDidMountIn.bind(this)),t.on(m.EVENTS.FLOW_CDU,this.componentDidUpdateIn.bind(this)),t.on(m.EVENTS.FLOW_RENDER,this.renderIn.bind(this))}bindBlockToEvents(t){const e={};return Object.entries(t).forEach((([t,s])=>{e[t]=t=>{s(t,this)}})),e}makePropsProxy(t){return new Proxy(t,{set:(t,e,s)=>{const r={...t};return"events"===e?(t[e]=this.bindBlockToEvents(s),!0):(t[e]=s,this.eventBus().emit(m.EVENTS.FLOW_CDU,r,t),!0)}})}init(){this.createResources(),this.eventBus().emit(m.EVENTS.FLOW_CDM)}createResources(){const{tagName:t}=this.meta;this.elementIn=document.createElement(t)}componentDidMountIn(){this.componentDidMount(),this.eventBus().emit(m.EVENTS.FLOW_RENDER)}renderBlocks(t){const e=document.createElement("template");return e.innerHTML=t,Object.values(this.props).reduce(((t,e)=>Array.isArray(e)&&e.every((t=>t instanceof m))?t.concat(e):(e instanceof m&&t.push(e),t)),[]).forEach((t=>{const s=e.content.querySelector(`[data-uuid="${t.id}"]`);s&&s.replaceWith(t.element)})),e.content}renderIn(){const t=this.render();this.removeEvents(),this.removeAttrs();const e=this.renderBlocks(t);this.elementIn.innerHTML="",this.elementIn.appendChild(e),this.addAttrs(),this.addEvents()}addAttrs(){Object.entries(this.attrs).forEach((([t,e])=>{this.elementIn.setAttribute(t,e)}))}removeAttrs(){Object.keys(this.attrs).forEach((t=>{this.elementIn.removeAttribute(t)}))}toString(){return`<div data-uuid = ${this.id}></div>`}removeEvents(){this.props.events&&Object.entries(this.props.events).forEach((([t,e])=>{this.element.removeEventListener(t,e)}))}addEvents(){this.props.events&&Object.entries(this.props.events).forEach((([t,e])=>{this.element.addEventListener(t,e)}))}componentDidUpdateIn(t,e){this.componentDidUpdate(t,e),t!==e&&this.eventBus().emit(m.EVENTS.FLOW_RENDER)}get element(){return this.elementIn}setProps(t){t&&Object.assign(this.props,t)}render(){return""}componentDidMount(){}componentDidUpdate(t,e){}constructor(t="div",e={},s={}){const r=new f;this.meta={tagName:t,props:s,attrs:e},this.id=v();const n={...s};n.events&&(n.events=this.bindBlockToEvents(n.events)),this.props=this.makePropsProxy(n),this.attrs=e,this.eventBus=()=>r,this.registerEvents(r),r.emit(m.EVENTS.INIT)}}m.EVENTS={INIT:"init",FLOW_CDM:"flow:component-did-mount",FLOW_CDU:"flow:component-did-update",FLOW_RENDER:"flow:render"};var g=m;var y=function(t){var e,s="",r={},n=t||{};return function(t){r.centering=e=function(){var t=this&&this.block;this&&this.attributes;s+='<div class="centering"> ',t&&t(),s+="</div>"},r.centering.call({block:function(){s=s+"<div> "+(null==(e=t)?"":e)+"</div>"}})}.call(this,"form"in n?n.form:"undefined"!=typeof form?form:void 0),s};var b=function(t){var e,s="",r=t||{};return function(t){s=s+'<span class="button__text">'+(null==(e=t)?"":e)+"</span>"}.call(this,"content"in r?r.content:"undefined"!=typeof content?content:void 0),s};var w=class extends g{setClass(){let t="button";this.props.fullWidth&&(t=`${t} button_fullWidth`),this.props.theme&&(t=`${t} button_theme_${this.props.theme}`),this.attrs.class=t}render(){return this.setClass(),b(this.props)}constructor(t){super("button",{},{fullWidth:t.fullWidth,content:t.content,theme:t.theme,events:{click:t.onclick}})}};var _=class extends g{setClass(){let t="input";this.props.wrong&&(t=`${t} input_wrong`),this.props.fullHeight&&(t=`${t} input_fullHeight`),this.attrs.class=t}render(){return this.setClass(),""}constructor(t){super("input",{class:"input",placeholder:t.placeholder,name:t.name,type:t.type},{events:t.events,wrong:!1,validFunc:t.validFunc,fullHeight:t.fullHeight,name:t.name})}};var E=class extends g{checkInput(t){if(!t.props.validFunc)return;const e=t.element;t.props.validFunc(e.value)||t.setProps({wrong:!0})}checkValidFields(){let t=!0;return this.props.fields.forEach((e=>{this.checkInput(e),!0===e.props.wrong&&(t=!1)})),t}setFormValues(t){Object.entries(t).forEach((([t,e])=>{const s=this.props.fields.find((e=>e.props.name===t));if(!s)return;s.element.value=e}))}getFormValues(){return this.props.fields.reduce(((t,e)=>({...t,[e.attrs.name]:e.element.value})),{})}constructor(t){super("div",{},{fields:t.fields.map((t=>new _({events:{blur:(t,e)=>{this.checkInput(e)},focus:(e,s)=>{t.validFunc&&s.setProps({wrong:!1})}},validFunc:t.validFunc,placeholder:t.placeholder,name:t.name,type:t.type}))),button:new w({content:t.buttonText,fullWidth:!0,onclick:()=>{const e=this.getFormValues();if(!t.valid)return void t.submit(e);this.checkValidFields()&&t.submit(e)}})})}};var k=/["&<>]/;var S=function(t){var e,s="",r=t||{};return function(t,r,n){s+='<div class="main-form_content">',function(){var t=n||["There are no values"];if("number"==typeof t.length)for(var r=0,a=t.length;r<a;r++){var i=t[r];s+=null==(e=i)?"":e}else{a=0;for(var r in t){a++;i=t[r];s+=null==(e=i)?"":e}}}.call(this),s=s+'</div><div class="main-form_button">'+(null==(e=t)?"":e)+"</div>",r&&(s=s+'<div class="main-form_error">'+function(t){var e=""+t,s=k.exec(e);if(!s)return t;var r,n,a,i="";for(r=s.index,n=0;r<e.length;r++){switch(e.charCodeAt(r)){case 34:a="&quot;";break;case 38:a="&amp;";break;case 60:a="&lt;";break;case 62:a="&gt;";break;default:continue}n!==r&&(i+=e.substring(n,r)),n=r+1,i+=a}return n!==r?i+e.substring(n,r):i}(null==(e=r)?"":e)+"</div>")}.call(this,"button"in r?r.button:"undefined"!=typeof button?button:void 0,"error"in r?r.error:"undefined"!=typeof error?error:void 0,"fields"in r?r.fields:"undefined"!=typeof fields?fields:void 0),s};var x=class extends E{render(){return S({button:this.props.button,fields:this.props.fields,error:this.props.error})}constructor(t){super({fields:t.fields,buttonText:t.buttonText,valid:t.valid,error:t.error,submit:t.submit})}};var C=/["&<>]/;var A=function(t){var e,s="",r=t||{};return function(t,r,n){s=s+'<div class="identification"><div class="identification_body"><div class="identification_title">'+function(t){var e=""+t,s=C.exec(e);if(!s)return t;var r,n,a,i="";for(r=s.index,n=0;r<e.length;r++){switch(e.charCodeAt(r)){case 34:a="&quot;";break;case 38:a="&amp;";break;case 60:a="&lt;";break;case 62:a="&gt;";break;default:continue}n!==r&&(i+=e.substring(n,r)),n=r+1,i+=a}return n!==r?i+e.substring(n,r):i}(null==(e=n)?"":e)+'</div><div class="identification_form">'+(null==(e=t)?"":e)+'</div></div><div class="identification_helper">'+(null==(e=r)?"":e)+"</div></div>"}.call(this,"form"in r?r.form:"undefined"!=typeof form?form:void 0,"helper"in r?r.helper:"undefined"!=typeof helper?helper:void 0,"title"in r?r.title:"undefined"!=typeof title?title:void 0),s};var T=class extends g{render(){return A({title:this.props.title,form:this.props.form,helper:this.props.helper})}constructor(t){super("div",{},{title:t.title,form:t.form,helper:t.helper})}};var I=/["&<>]/;var F=function(t){var e,s="",r=t||{};return function(t,r){s=s+'<div class="helper"><span class="helper__text">'+function(t){var e=""+t,s=I.exec(e);if(!s)return t;var r,n,a,i="";for(r=s.index,n=0;r<e.length;r++){switch(e.charCodeAt(r)){case 34:a="&quot;";break;case 38:a="&amp;";break;case 60:a="&lt;";break;case 62:a="&gt;";break;default:continue}n!==r&&(i+=e.substring(n,r)),n=r+1,i+=a}return n!==r?i+e.substring(n,r):i}(null==(e=r)?"":e)+'  <span class="helper__button">'+(null==(e=t)?"":e)+"</span></span></div>"}.call(this,"link"in r?r.link:"undefined"!=typeof link?link:void 0,"text"in r?r.text:"undefined"!=typeof text?text:void 0),s};var L=class extends g{render(){return F({text:this.props.text,link:this.props.link})}constructor(t){super("div",{},{text:t.text,link:new w({onclick:t.onclick,content:t.textLink,theme:"link"})})}};var P=class{match(t){return this.pathname.startsWith(t)}render(){this.block=new this.BlockClass,this.currentRoot.innerHTML="",this.currentRoot.appendChild(this.block.element)}constructor(t,e,s){this.pathname=t,this.BlockClass=e,this.block=null,this.currentRoot=s}};class D{use(t,e){const s=new P(t,e,this.currentRoot);return this.routes.push(s),this}start(){window.onpopstate=t=>{const e=t.target;this.onRoute(e.location.pathname)},this.onRoute(window.location.pathname)}onRoute(t){const e=this.getRoute(t);e&&e.render()}go(t){this.history.pushState({},t,t),this.onRoute(t)}back(){this.history.back()}forward(){this.history.forward()}getRoute(t){return this.routes.find((e=>e.match(t)))}constructor(t){if(D.instance)return D.instance;if(!t)throw Error("undefind root node");this.routes=[],this.history=window.history,this.currentRoot=t,D.instance=this}}var O=D;var N=class{};const R="GET",U="PUT",M="POST",$="DELETE";var B=class{get(t){const e=this.startUrl+t;return this.request(e,{method:R})}put(t,e){return this.request(this.startUrl+t,{data:e,method:U})}post(t,e){return this.request(this.startUrl+t,{data:e,method:M})}delete(t,e){return this.request(this.startUrl+t,{data:e,method:$})}request(t,e){const{method:s,data:r}=e;return new Promise(((e,n)=>{const a=new XMLHttpRequest;a.open(s,t),Object.entries(this.headers).forEach((t=>a.setRequestHeader(...t))),a.responseType="json",a.onload=()=>{a.status<400?e(a.response):n(a.response)},a.onabort=n,a.onerror=n,a.timeout=this.timeout,a.ontimeout=n,a.withCredentials=!0,s!==R&&r?r instanceof FormData?a.send(r):(a.setRequestHeader("Content-Type","application/json"),a.send(JSON.stringify(r))):a.send()}))}constructor(t,e={}){this.startUrl=t,this.timeout=e.timeout||1e4,this.headers=e.headers||{}}};const V=new B("https://ya-praktikum.tech/api/v2/auth");var W=class extends N{login(t){return V.post("/signin",t)}logout(){return V.post("/logout")}create(t){return V.post("/signup",t)}request(){return V.get("/user")}};var j=t=>({type:"errors/SETAUTH",payload:t});var H=t=>({type:"profile/SET",payload:t});var q=t=>({type:"errors/SETREG",payload:t});var Z=new class{addReducer(t,e){return this.reducers[t]=e,this.dispatch({type:"@@INIT"}),this}getState(){return this.state}dispatch(t){this.state=this.reducer(t),this.emitListeners()}emitListeners(){this.listeners.forEach((t=>t(this.state)))}subscribe(t){t(this.state),this.listeners.push(t)}reducer(t){const e={};return Object.entries(this.reducers).forEach((([s,r])=>{e[s]=r(this.state[s],t)})),e}constructor(){this.state={},this.listeners=[],this.reducers={}}};var z=new class{async login(t){try{await this.api.login(t),(new O).go("/")}catch(t){Z.dispatch(j(t))}}async logout(){try{await this.api.logout(),(new O).go("/auth/")}catch(t){console.log(t)}}async reg(t){try{await this.api.create(t),(new O).go("/")}catch(t){Z.dispatch(q(t))}}async getProfile(){try{const t=await this.api.request();Z.dispatch(H(t))}catch(t){(new O).go("/auth/")}}async checkNotAuth(){const t=await this.api.request();(new O).go("/"),Z.dispatch(H(t))}constructor(){this.api=new W}};function J(t){return function(t){return"object"==typeof t&&null!==t&&t.constructor===Object&&"[object Object]"===Object.prototype.toString.call(t)}(t)||function(t){return Array.isArray(t)}(t)}var G=function t(e,s){if(Object.keys(e).length!==Object.keys(s).length)return!1;for(const[r,n]of Object.entries(e)){const e=s[r];if(J(n)&&J(e)){if(t(n,e))continue;return!1}if(n!==e)return!1}return!0};var X=(t,e)=>{let s;return r=>{const n=t(r);G({a:n},{a:s})||(e(n),s=n)}};var K=t=>t.errors.reg;class Q extends g{componentDidMount(){z.checkNotAuth(),document.title="Регистрация";const t=X((t=>K(t)),(t=>{t&&this.props.regForm.props.form.setProps({error:t.reason})}));Z.subscribe((e=>{t(e)}))}render(){return y({form:this.props.regForm})}constructor(){super("div",{},{regForm:new T({title:"Регистрация",form:new x({valid:!0,buttonText:"Зарегистрироваться",fields:[{placeholder:"Имя",name:"first_name",type:"text",validFunc:t=>/^[А-ЯA-Z][а-яёЁa-z]+$/.test(t)},{placeholder:"Фамилия",name:"second_name",type:"text",validFunc:t=>/^[А-ЯA-Z][а-яёЁa-z]+$/.test(t)},{placeholder:"Логин",name:"login",type:"text",validFunc:t=>/^(?=.*[a-zA-Z_-])[a-zA-Z0-9-_]{3,20}$/.test(t)},{placeholder:"Почта",name:"email",type:"text",validFunc:t=>/^(?=.*[a-zA-Z_@-])[a-zA-Z_@-]+@[a-zA-Z_-]+\.[a-zA-Z_-]+$/.test(t)},{placeholder:"Телефон",name:"phone",type:"text",validFunc:t=>/^[\d/+]\d{9,14}$/.test(t)},{placeholder:"Пароль",name:"password",type:"password",validFunc:t=>/^(?=.*[A-ZА-Я])(?=.*\d).{8,40}$/.test(t)}],submit:t=>{z.reg(t)}}),helper:new L({text:"Уже есть аккаун?",onclick:()=>{(new O).go("/auth/")},textLink:"Войти"})})})}}var Y=function(t){var e,s="",r={},n=t||{};return function(t){r.centering=e=function(){var t=this&&this.block;this&&this.attributes;s+='<div class="centering"> ',t&&t(),s+="</div>"},r.centering.call({block:function(){s=s+"<div> "+(null==(e=t)?"":e)+"</div>"}})}.call(this,"form"in n?n.form:"undefined"!=typeof form?form:void 0),s};var tt=t=>t.errors.auth;class et extends g{componentDidMount(){document.title="Вход",z.checkNotAuth();const t=X((t=>tt(t)),(t=>{t&&this.props.form.props.form.setProps({error:t.reason})}));Z.subscribe((e=>{t(e)}))}render(){return Y({form:this.props.form})}constructor(){super("div",{},{form:new T({title:"Вход",form:new x({valid:!0,buttonText:"Войти",fields:[{placeholder:"Логин",name:"login",type:"text"},{placeholder:"Пароль",name:"password",type:"password"}],submit:async t=>{await z.login(t)}}),helper:new L({text:"Нет аккаунта?",onclick:()=>{(new O).go("/reg/")},textLink:"Регистрация"})})})}}const st=new B("https://ya-praktikum.tech/api/v2/chats");var rt=class extends N{request(){return st.get("/")}create(t){return st.post("/",t)}token(t){return st.post(`/token/${t}`)}updateAvatar(t){return st.put("/avatar",t)}};var nt=t=>({type:"currentChat/SETACTIVECHATID",payload:t});var at=(t,e)=>({type:"chats/SETCHATAVATAR",payload:{chatId:t,avatar:e}});var it=()=>({type:"popUp/SETCHATNAMEDISABLE"});var ot=t=>({type:"chats/SET",payload:t});var ct=t=>t.chats.find((e=>e.id===t.currentChat.activeChatId));var dt=t=>t.profile;var lt=t=>{const e=dt(t),s=ct(t);return(null==e?void 0:e.id)===(null==s?void 0:s.created_by)};var ut=(t,e)=>t.chats.find((t=>t.id===e));var pt=(t,e)=>({type:"chats/ADDNEWMESSAGES",payload:{chatId:t,messages:e}});var ht=(t,e)=>({type:"chats/ADDOLDMESSAGES",payload:{chatId:t,messages:e}});var vt=new class{async connect(t){const e=Z.getState(),s=dt(e);if(!s)return;const r=new rt,{token:n}=await r.token(t),a=new WebSocket(`wss://ya-praktikum.tech/ws/chats/${s.id}/${t}/${n}`);this.sockets[t]=a,a.addEventListener("message",(e=>{this.get(e.data,t)}))}async get(t,e){const s=await JSON.parse(t);"message"===s.type&&Z.dispatch(pt(e,[s])),Array.isArray(s)&&Z.dispatch(ht(e,s))}send(t){if(!t)return;const e=Z.getState(),s=ct(e);s&&this.sockets[s.id].send(JSON.stringify({content:t,type:"message"}))}async getlastMessages(t,e=0){this.sockets[t].send(JSON.stringify({content:e,type:"get old"}))}constructor(){this.sockets={}}};var ft=new class{async init(){try{const t=await this.api.request();Z.dispatch(ot(t)),t.forEach((t=>{vt.connect(t.id)}))}catch(t){console.log(t)}}async get(t){Z.dispatch(nt(t));const e=Z.getState(),s=ut(e,t);if(s&&(!s.messages||s.messages.length<20)){const e=s.messages?s.messages.length:0;vt.getlastMessages(t,e)}}async create(t){try{await this.api.create(t),Z.dispatch(it()),this.init()}catch(t){console.log(t)}}async updateAvatar(t){try{const e=Z.getState(),s=ct(e);if(!s)return;if(!lt(e))return;const r=new FormData;r.append("avatar",t),r.append("chatId",s.id.toString());const n=await this.api.updateAvatar(r);Z.dispatch(at(s.id,n.avatar))}catch(t){console.log(t)}}constructor(){this.api=new rt}};function mt(t){var e=""+t,s=gt.exec(e);if(!s)return t;var r,n,a,i="";for(r=s.index,n=0;r<e.length;r++){switch(e.charCodeAt(r)){case 34:a="&quot;";break;case 38:a="&amp;";break;case 60:a="&lt;";break;case 62:a="&gt;";break;default:continue}n!==r&&(i+=e.substring(n,r)),n=r+1,i+=a}return n!==r?i+e.substring(n,r):i}var gt=/["&<>]/;var yt=function(t){var e,s="",r=t||{};return function(t,r,n,a,i){s=s+'<div class="chat-item__main"><div class="chat-item__img-container"><img class="chat-item__img"'+function(t,e,s,r){if(!1===e||null==e||!e&&("class"===t||"style"===t))return"";if(!0===e)return" "+(r?t:t+'="'+t+'"');var n=typeof e;return"object"!==n&&"function"!==n||"function"!=typeof e.toJSON||(e=e.toJSON()),"string"==typeof e||(e=JSON.stringify(e),s||-1===e.indexOf('"'))?(s&&(e=mt(e))," "+t+'="'+e+'"'):" "+t+"='"+e.replace(/'/g,"&#39;")+"'"}("src",a,!0,!1)+'/></div><div class="chat-item__content"><p class="chat-item__author">'+mt(null==(e=t)?"":e)+' </p><p class="chat-item__message">'+mt(null==(e=i)?"":e)+'</p></div></div><div class="chat-item__meta"><div class="chat-item__count">',0!==r&&(s=s+'<div class="chat-item__count-text">'+mt(null==(e=r)?"":e)+"</div>"),s=s+'</div><p class="chat-item__date">'+mt(null==(e=n)?"":e)+"</p></div>"}.call(this,"author"in r?r.author:"undefined"!=typeof author?author:void 0,"count"in r?r.count:"undefined"!=typeof count?count:void 0,"date"in r?r.date:"undefined"!=typeof date?date:void 0,"img"in r?r.img:"undefined"!=typeof img?img:void 0,"message"in r?r.message:"undefined"!=typeof message?message:void 0),s};var bt=class extends g{setClass(){let t="chat-item";this.props.active&&(t=`${t} chat-item_active`),this.attrs.class=t}componentDidMount(){const t=X((t=>ct(t)),(t=>{t&&this.setProps({active:this.props.id===t.id})}));Z.subscribe((e=>{t(e)}))}render(){return this.setClass(),yt(this.props)}constructor(t){super("div",{},{id:t.id,author:t.author,message:t.message,date:t.date,count:t.count,img:t.img,active:!1,events:{click:()=>{ft.get(this.props.id)}}})}};function wt(t){var e=""+t,s=_t.exec(e);if(!s)return t;var r,n,a,i="";for(r=s.index,n=0;r<e.length;r++){switch(e.charCodeAt(r)){case 34:a="&quot;";break;case 38:a="&amp;";break;case 60:a="&lt;";break;case 62:a="&gt;";break;default:continue}n!==r&&(i+=e.substring(n,r)),n=r+1,i+=a}return n!==r?i+e.substring(n,r):i}var _t=/["&<>]/;var Et=function(t){var e,s="",r=t||{};return function(t,r){s=s+'<div class="profile-button"><div class="profile-button__img-container"><img class="profile-button__img"'+function(t,e,s,r){if(!1===e||null==e||!e&&("class"===t||"style"===t))return"";if(!0===e)return" "+(r?t:t+'="'+t+'"');var n=typeof e;return"object"!==n&&"function"!==n||"function"!=typeof e.toJSON||(e=e.toJSON()),"string"==typeof e||(e=JSON.stringify(e),s||-1===e.indexOf('"'))?(s&&(e=wt(e))," "+t+'="'+e+'"'):" "+t+"='"+e.replace(/'/g,"&#39;")+"'"}("src",t,!0,!1)+'/></div><p class="profile-button__name">'+wt(null==(e=r)?"":e)+"</p></div>"}.call(this,"avatar"in r?r.avatar:"undefined"!=typeof avatar?avatar:void 0,"name"in r?r.name:"undefined"!=typeof name?name:void 0),s};var kt=class extends g{render(){return Et(this.props)}constructor(t){super("div",{},{avatar:t.avatar,name:t.name,link:t.link,events:{click:()=>{this.props.link&&(new O).go(this.props.link)}}})}};var St=function(t){var e,s="",r=t||{};return function(t,r,n,a){s=s+'<div class="chat-list__search">'+(null==(e=a)?"":e)+'</div><div class="chat-list__bar">'+(null==(e=r)?"":e)+'</div><div class="chat-list__footer"> <div class="chat-list__profile">'+(null==(e=n)?"":e)+'</div><div class="chat-list__add">'+(null==(e=t)?"":e)+" </div></div>"}.call(this,"addChatButton"in r?r.addChatButton:"undefined"!=typeof addChatButton?addChatButton:void 0,"chatBar"in r?r.chatBar:"undefined"!=typeof chatBar?chatBar:void 0,"profile"in r?r.profile:"undefined"!=typeof profile?profile:void 0,"search"in r?r.search:"undefined"!=typeof search?search:void 0),s};var xt=t=>t.chats;var Ct=()=>({type:"popUp/SETCHATNAMEACTIVE"});var At=t=>{const e=new Date(Date.parse(t));return`${e.getHours()}:${e.getMinutes()}`};var Tt=function(t){var e,s="",r=t||{};return function(t){(function(){var r=t||["There are no values"];if("number"==typeof r.length)for(var n=0,a=r.length;n<a;n++){var i=r[n];s+=null==(e=i)?"":e}else{a=0;for(var n in r){a++;i=r[n];s+=null==(e=i)?"":e}}}).call(this)}.call(this,"chats"in r?r.chats:"undefined"!=typeof chats?chats:void 0),s};var It,Ft=class extends g{render(){const t=this.props.chats.filter((t=>t.props.author.startsWith(this.props.searchValue)));return Tt({chats:t})}constructor(){super("div",{},{chats:[],searchValue:""})}};It=new URL(i("j7mty").resolve("9fssg"),import.meta.url).toString();var Lt=t=>t?`https://ya-praktikum.tech/api/v2/resources${t}`:e(It);var Pt=class extends g{setClass(){this.attrs.class="chat-list"}componentDidMount(){const t=X((t=>xt(t)),(t=>{this.props.chatBar.setProps({chats:t.map((t=>{const e=t.messages?t.messages[0]:t.last_message;return new bt({id:t.id,author:t.title,message:e?e.content:"Пока нет сообщений",date:e?At(e.time):"",count:t.unread_count,img:Lt(t.avatar)})}))})})),e=X((t=>dt(t)),(t=>{t&&this.props.profile.setProps({avatar:Lt(t.avatar),name:`${t.first_name} ${t.second_name}`})}));Z.subscribe((s=>{t(s),e(s)}))}render(){return this.setClass(),St(this.props)}constructor(){super("div",{},{chatBar:new Ft,search:new _({placeholder:"Поиск по чатам",name:"search",type:"text",events:{input:t=>{if(!t.target)return;const e=t.target;this.props.chatBar.setProps({searchValue:e.value})}}}),addChatButton:new w({content:"Новый чат",onclick:()=>{Z.dispatch(Ct())}}),profile:new kt({avatar:"",link:"/profile/",name:""})})}};var Dt=function(t){var e,s="",r=t||{};return function(t,r,n,a){s=s+((null==(e=t)?"":e)+"\n")+(null==(e=a)?"":e)+"\n"+(null==(e=r)?"":e)+"\n"+(null==(e=n)?"":e)}.call(this,"chatList"in r?r.chatList:"undefined"!=typeof chatList?chatList:void 0,"chatNamePopUp"in r?r.chatNamePopUp:"undefined"!=typeof chatNamePopUp?chatNamePopUp:void 0,"chatSettingsPopUp"in r?r.chatSettingsPopUp:"undefined"!=typeof chatSettingsPopUp?chatSettingsPopUp:void 0,"chatWindow"in r?r.chatWindow:"undefined"!=typeof chatWindow?chatWindow:void 0),s};var Ot=function(t){var e,s="",r=t||{};return function(t,r,n,a){s=s+'<div class="chat-window__header"> <div class="chat-window__profile"> '+(null==(e=a)?"":e)+'</div><div class="chat-window__settings-button"> '+(null==(e=t)?"":e)+'</div></div><div class="chat-window__messeges">'+(null==(e=n)?"":e)+'</div><div class="chat-window__input">'+(null==(e=r)?"":e)+"</div>"}.call(this,"chatSettingsButton"in r?r.chatSettingsButton:"undefined"!=typeof chatSettingsButton?chatSettingsButton:void 0,"message"in r?r.message:"undefined"!=typeof message?message:void 0,"messagesList"in r?r.messagesList:"undefined"!=typeof messagesList?messagesList:void 0,"profile"in r?r.profile:"undefined"!=typeof profile?profile:void 0),s};var Nt=function(t){var e,s="",r=t||{};return function(t,r){s=s+'<div class="create-message"> <div class="create-message_input">'+(null==(e=t)?"":e)+'</div><div class="create-message_button">'+(null==(e=r)?"":e)+"</div></div>"}.call(this,"inputMessage"in r?r.inputMessage:"undefined"!=typeof inputMessage?inputMessage:void 0,"sendButton"in r?r.sendButton:"undefined"!=typeof sendButton?sendButton:void 0),s};var Rt=class extends g{sendMessage(){const t=this.props.inputMessage.element;vt.send(t.value),t.value=""}componentDidMount(){document.addEventListener("keydown",(t=>{"Enter"===t.key&&(t.preventDefault(),this.sendMessage())}))}render(){return Nt(this.props)}constructor(){super("div",{},{sendButton:new w({content:"Отправить",onclick:()=>this.sendMessage()}),inputMessage:new _({placeholder:"Напишите сообщение",name:"message",type:"text",fullHeight:!0})})}};var Ut=t=>{const e=ct(t);return e?e.messages:[]};var Mt=function(t){var e,s="",r=t||{};return function(t){(function(){var r=t||["There are no values"];if("number"==typeof r.length)for(var n=0,a=r.length;n<a;n++){var i=r[n];s+=null==(e=i)?"":e}else{a=0;for(var n in r){a++;i=r[n];s+=null==(e=i)?"":e}}}).call(this)}.call(this,"messages"in r?r.messages:"undefined"!=typeof messages?messages:void 0),s};function $t(t){var e=""+t,s=Bt.exec(e);if(!s)return t;var r,n,a,i="";for(r=s.index,n=0;r<e.length;r++){switch(e.charCodeAt(r)){case 34:a="&quot;";break;case 38:a="&amp;";break;case 60:a="&lt;";break;case 62:a="&gt;";break;default:continue}n!==r&&(i+=e.substring(n,r)),n=r+1,i+=a}return n!==r?i+e.substring(n,r):i}var Bt=/["&<>]/;var Vt=function(t){var e,s="",r=t||{};return function(t,r){s=s+'<div class="message_content"> '+$t(null==(e=r)?"":e)+'</div><div class="message_footer"> <div class="message_author"> </div><div class="message_date"> '+$t(null==(e=t)?"":e)+"</div></div>"}.call(this,"date"in r?r.date:"undefined"!=typeof date?date:void 0,"text"in r?r.text:"undefined"!=typeof text?text:void 0),s};var Wt=class extends g{setClass(){let t="message";this.props.self&&(t=`${t} message__self`),this.attrs.class=t}render(){return this.setClass(),Vt(this.props)}constructor(t){super("div",{},{id:t.id,text:t.text,date:t.date,self:t.self})}};var jt=class extends g{componentDidMount(){const t=X((t=>({messages:Ut(t),profile:dt(t)})),(({messages:t,profile:e})=>{t&&e&&this.setProps({messages:t.map((t=>new Wt({id:t.id,text:t.content,date:At(t.time),self:t.user_id===e.id})))})}));Z.subscribe((e=>{t(e)}))}setClass(){this.attrs.class="messages-list"}render(){return this.setClass(),Mt(this.props)}constructor(){super("div",{},{messages:["dssdf","sdfsf"]})}};const Ht=new B("https://ya-praktikum.tech/api/v2/chats/users");var qt=class extends N{request(t){return new B(`https://ya-praktikum.tech/api/v2/chats/${t}/users`).get("/")}create(t){return Ht.put("/",{users:[t.userId],chatId:t.chatId})}delete(t){return Ht.delete("/",{users:[t.userId],chatId:t.chatId})}};var Zt=()=>({type:"popUp/SETCHATSETTINGACTIVE"});var zt=t=>({type:"chats/SETMEMBERS",payload:t});var Jt=new class{openMembersPopUp(){Z.dispatch(Zt());const t=ct(Z.getState());t&&this.get(t.id)}async get(t){try{const e=await this.api.request(t);Z.dispatch(zt({chatId:t,members:e}))}catch(t){console.log(t)}}async add(t){try{const e=ct(Z.getState());if(!e)return;await this.api.create({userId:t,chatId:e.id}),this.get(e.id)}catch(t){console.log(t)}}async delete(t){try{const e=ct(Z.getState());if(!e)return;await this.api.delete({userId:t,chatId:e.id}),this.get(e.id)}catch(t){console.log(t)}}constructor(){this.api=new qt}};var Gt=class extends g{setClass(){const t=`icon icon_name_${this.props.name}`;this.attrs.class=t}render(){return this.setClass(),""}constructor(t){super("div",{},{name:t.name})}};var Xt=class extends g{setClass(){this.attrs.class="chat-window"}componentDidMount(){Z.subscribe((t=>{const e=ct(t);e&&this.props.profile.setProps({avatar:Lt(e.avatar),name:e.title})}))}render(){return this.setClass(),Ot(this.props)}constructor(){super("div",{},{profile:new kt({avatar:e(It),name:""}),chatSettingsButton:new w({content:new Gt({name:"sliders"}),theme:"icon",onclick:()=>Jt.openMembersPopUp()}),message:new Rt,messagesList:new jt})}};var Kt=function(t){var e,s="",r=t||{};return function(t){s=s+'<div class="content">'+(null==(e=t)?"":e)+"</div>"}.call(this,"content"in r?r.content:"undefined"!=typeof content?content:void 0),s};var Qt=class extends g{setClass(){let t="pop-up";t=this.props.active?`${t} pop-up_active`:`${t} pop-up_disable`,this.attrs.class=t}render(){return this.setClass(),Kt(this.props)}constructor(t){super("div",{},{content:t.content,events:{mousedown:e=>{e.target===e.currentTarget&&t.disableFunc()}},active:t.active})}};var Yt=function(t){var e,s="",r=t||{};return function(t){s=s+'<div class="create-chat_title">Новый чат</div><div class="create-chat_form"> '+(null==(e=t)?"":e)+"</div>"}.call(this,"form"in r?r.form:"undefined"!=typeof form?form:void 0),s};var te=class extends g{setClass(){this.attrs.class="create-chat"}render(){return this.setClass(),Yt(this.props)}constructor(){super("div",{},{form:new x({valid:!0,buttonText:"Создать чат",fields:[{placeholder:"Название чата",name:"name",type:"text"}],submit:async t=>{ft.create({title:t.name})}})})}};var ee=t=>t.popUp.chatName;var se=()=>({type:"popUp/SETCHATSETTINGDISABLE"});var re=t=>t.popUp.chatSetting;const ne=new B("https://ya-praktikum.tech/api/v2/user");var ae=class extends N{search(t){return ne.post("/search",{login:t})}update(t){return ne.put("/profile",t)}updatePassword(t){return ne.put("/password",t)}updateAvatar(t){return ne.put("/profile/avatar",t)}};var ie=()=>({type:"errors/CLEARPASSWORD"});var oe=()=>({type:"errors/CLEARPROFILE"});var ce=t=>({type:"errors/SETPASSWORD",payload:t});var de=t=>({type:"errors/SETPROFILE",payload:t});var le=t=>({type:"searchUsers/SETUSERS",payload:t});var ue=t=>t.searchUsers;var pe=new class{async search(t){try{const e=Z.getState(),s=lt(e);if(t.length<3||!s){return void(ue(e).length>0&&Z.dispatch(le([])))}const r=await this.api.search(t);Z.dispatch(le(r))}catch(t){console.log(t)}}async updateProfile(t){try{const e=await this.api.update(t);Z.dispatch(H(e)),Z.dispatch(oe())}catch(t){Z.dispatch(de(t))}}async updatePassword(t){try{await this.api.updatePassword(t),Z.dispatch(ie())}catch(t){Z.dispatch(ce(t))}}async updateAvatar(t){try{const e=new FormData;e.append("avatar",t);const s=await this.api.updateAvatar(e);Z.dispatch(H(s))}catch(t){console.log(t)}}constructor(){this.api=new ae}};var he=function(t){const e=ct(t);if(!e)return[];const s=e.members||[],r=s.map((t=>t.id)),n=ue(t).filter((t=>!r.includes(t.id))).map((t=>({...t,role:"none"})));return s.concat(n)};var ve=function(t){var e,s="",r=t||{};return function(t){s+='<div class="chat-settings-users">',function(){var r=t||["There are no values"];if("number"==typeof r.length)for(var n=0,a=r.length;n<a;n++){var i=r[n];s+=null==(e=i)?"":e}else{a=0;for(var n in r){a++;i=r[n];s+=null==(e=i)?"":e}}}.call(this),s+="</div>"}.call(this,"members"in r?r.members:"undefined"!=typeof members?members:void 0),s};var fe=class extends g{render(){const t=this.props.members.filter((t=>t.props.login.startsWith(this.props.searchValue)));return ve({members:t})}constructor(){super("div",{},{searchValue:"",members:[]})}};var me=/["&<>]/;var ge=function(t){var e,s="",r=t||{};return function(t,r,n,a){s=s+'<div class="chat-settings_header">'+function(t){var e=""+t,s=me.exec(e);if(!s)return t;var r,n,a,i="";for(r=s.index,n=0;r<e.length;r++){switch(e.charCodeAt(r)){case 34:a="&quot;";break;case 38:a="&amp;";break;case 60:a="&lt;";break;case 62:a="&gt;";break;default:continue}n!==r&&(i+=e.substring(n,r)),n=r+1,i+=a}return n!==r?i+e.substring(n,r):i}(null==(e=r)?"":e)+'</div><div class="chat-settings_avatar-changer">'+(null==(e=t)?"":e)+'</div><div class="chat-settings_search">'+(null==(e=a)?"":e)+'</div><div class="chat-settings_members">'+(null==(e=n)?"":e)+"</div>"}.call(this,"avatarChanger"in r?r.avatarChanger:"undefined"!=typeof avatarChanger?avatarChanger:void 0,"header"in r?r.header:"undefined"!=typeof header?header:void 0,"members"in r?r.members:"undefined"!=typeof members?members:void 0,"search"in r?r.search:"undefined"!=typeof search?search:void 0),s};var ye=function(t){var e,s="",r=t||{};return function(t,r){s=s+'<div class="member-itom"><div class="member-itom__profile">'+(null==(e=r)?"":e)+'</div><div class="member-itom__button">'+(null==(e=t)?"":e)+"</div></div>"}.call(this,"button"in r?r.button:"undefined"!=typeof button?button:void 0,"profile"in r?r.profile:"undefined"!=typeof profile?profile:void 0),s};var be=class extends g{render(){return ye(this.props)}constructor(t){var e,s,r;super("div",{},{login:t.member.login,profile:new kt({avatar:Lt(t.member.avatar),name:`${t.member.first_name} ${t.member.second_name} (${t.member.login})`,link:`/user/${t.member.login}`}),button:(e=t.member.role,s=t.member.id,r=t.root,r&&"admin"!==e?new w("none"===e?{content:new Gt({name:"plus-square"}),theme:"icon",onclick:()=>Jt.add(s)}:{content:new Gt({name:"trash-2"}),theme:"icon",onclick:()=>Jt.delete(s)}):"")})}};var we=function(t){var e,s="",r=t||{};return function(t){s=s+'<span class="button__text">'+(null==(e=t)?"":e)+"</span>"}.call(this,"content"in r?r.content:"undefined"!=typeof content?content:void 0),s};var _e=class extends g{setClass(){this.attrs.class="input-file"}render(){return this.setClass(),we(this.props)}constructor(t){super("input",{type:"file",accept:t.accept,id:t.id},{events:{change:t.onchange}})}};function Ee(t,e,s,r){if(!1===e||null==e||!e&&("class"===t||"style"===t))return"";if(!0===e)return" "+(r?t:t+'="'+t+'"');var n=typeof e;return"object"!==n&&"function"!==n||"function"!=typeof e.toJSON||(e=e.toJSON()),"string"==typeof e||(e=JSON.stringify(e),s||-1===e.indexOf('"'))?(s&&(e=function(t){var e=""+t,s=ke.exec(e);if(!s)return t;var r,n,a,i="";for(r=s.index,n=0;r<e.length;r++){switch(e.charCodeAt(r)){case 34:a="&quot;";break;case 38:a="&amp;";break;case 60:a="&lt;";break;case 62:a="&gt;";break;default:continue}n!==r&&(i+=e.substring(n,r)),n=r+1,i+=a}return n!==r?i+e.substring(n,r):i}(e))," "+t+'="'+e+'"'):" "+t+"='"+e.replace(/'/g,"&#39;")+"'"}var ke=/["&<>]/;var Se=function(t){var e,s="",r=t||{};return function(t,r,n){s=s+"<label"+Ee("for",r,!0,!1)+'> <div class="avatar-changer__img-wrapper"><img class="avatar-changer__img"'+Ee("src",t,!0,!1)+'/></div></label><div class="avatar-changer__input">'+(null==(e=n)?"":e)+"</div>"}.call(this,"avatarLink"in r?r.avatarLink:"undefined"!=typeof avatarLink?avatarLink:void 0,"forId"in r?r.forId:"undefined"!=typeof forId?forId:void 0,"input"in r?r.input:"undefined"!=typeof input?input:void 0),s};var xe=class extends g{setClass(){this.attrs.class="avatar-changer"}render(){return this.setClass(),Se(this.props)}constructor(t){super("div",{},{input:new _e({accept:"image/*",id:t.name,onchange:t.onchange}),forId:t.name,link:t.avatarLink})}};var Ce=class extends g{setClass(){this.attrs.class="chat-settings"}componentDidMount(){const t=X((t=>ct(t)),(t=>{t&&(this.setProps({header:t.title}),this.props.avatarChanger.setProps({avatarLink:Lt(t.avatar)}))})),e=X((t=>({members:he(t),root:lt(t)})),(({members:t,root:e})=>{this.props.members.setProps({members:t.map((t=>new be({root:e,member:t})))})})),s=X((t=>lt(t)),(t=>{t?this.props.avatarChanger.setProps({forId:"avatarChat"}):this.props.avatarChanger.setProps({forId:""})}));Z.subscribe((r=>{t(r),e(r),s(r)}))}render(){return this.setClass(),ge(this.props)}constructor(){super("div",{},{header:"",avatarChanger:new xe({name:"avatarChat",avatarLink:Lt(""),onchange:t=>{null==t||t.preventDefault();const{files:e}=null==t?void 0:t.target;if(!e||!e[0])return;const[s]=e;ft.updateAvatar(s)}}),members:new fe,search:new _({placeholder:"Поиск пользователей",name:"searchUsers",type:"text",events:{input:t=>{if(!t.target)return;const e=t.target;this.props.members.setProps({searchValue:e.value}),pe.search(e.value)}}})})}};class Ae extends g{setClass(){this.attrs.class="chat"}componentDidMount(){document.title="Практикум чат",z.getProfile(),ft.init();const t=X((t=>ee(t)),(t=>{this.props.chatNamePopUp.setProps({active:t})})),e=X((t=>re(t)),(t=>{this.props.chatSettingsPopUp.setProps({active:t})}));Z.subscribe((s=>{t(s),e(s)}))}render(){return this.setClass(),Dt({chatList:this.props.chatList,chatWindow:this.props.chatWindow,chatNamePopUp:this.props.chatNamePopUp,chatSettingsPopUp:this.props.chatSettingsPopUp})}constructor(){super("div",{},{chatList:new Pt,chatWindow:new Xt,chatNamePopUp:new Qt({disableFunc:()=>{Z.dispatch(it())},content:new te,active:!0}),chatSettingsPopUp:new Qt({disableFunc:()=>{Z.dispatch(se())},content:new Ce,active:!0})})}}var Te=function(t){var e,s="",r={},n=t||{};return function(t){r.centering=e=function(){var t=this&&this.block;this&&this.attributes;s+='<div class="centering"> ',t&&t(),s+="</div>"},r.centering.call({block:function(){s=s+"<div> "+(null==(e=t)?"":e)+"</div>"}})}.call(this,"form"in n?n.form:"undefined"!=typeof form?form:void 0),s};var Ie=t=>t.errors.password;var Fe=t=>t.errors.profile;var Le=/["&<>]/;var Pe=function(t){var e,s="",r=t||{};return function(t,r,n,a,i){s=s+'<div class="profile-editor"><div class="profile-editor_body"><div class="profile-editor_title">'+function(t){var e=""+t,s=Le.exec(e);if(!s)return t;var r,n,a,i="";for(r=s.index,n=0;r<e.length;r++){switch(e.charCodeAt(r)){case 34:a="&quot;";break;case 38:a="&amp;";break;case 60:a="&lt;";break;case 62:a="&gt;";break;default:continue}n!==r&&(i+=e.substring(n,r)),n=r+1,i+=a}return n!==r?i+e.substring(n,r):i}(null==(e=i)?"":e)+'</div><div class="profile-editor_avatar">'+(null==(e=t)?"":e)+'</div><div class="profile-editor_dataform">'+(null==(e=r)?"":e)+'</div><div class="profile-editor_passwordform">'+(null==(e=a)?"":e)+'</div></div><div class="profile-editor_helper">'+(null==(e=n)?"":e)+"</div></div>"}.call(this,"avatarChanger"in r?r.avatarChanger:"undefined"!=typeof avatarChanger?avatarChanger:void 0,"dataForm"in r?r.dataForm:"undefined"!=typeof dataForm?dataForm:void 0,"helper"in r?r.helper:"undefined"!=typeof helper?helper:void 0,"passwordForm"in r?r.passwordForm:"undefined"!=typeof passwordForm?passwordForm:void 0,"title"in r?r.title:"undefined"!=typeof title?title:void 0),s};var De=class extends g{componentDidMount(){const t=X((t=>Fe(t)),(t=>{this.props.dataForm.setProps({error:t?t.reason:void 0})})),e=X((t=>Ie(t)),(t=>{this.props.passwordForm.setProps({error:t?t.reason:void 0})})),s=X((t=>dt(t)),(t=>{t&&(this.props.avatarChanger.setProps({avatarLink:Lt(t.avatar)}),this.props.dataForm.setFormValues({first_name:t.first_name,second_name:t.second_name,login:t.login,display_name:t.display_name,email:t.email,phone:t.phone}))}));Z.subscribe((r=>{t(r),e(r),s(r)}))}render(){return Pe({title:this.props.title,dataForm:this.props.dataForm,passwordForm:this.props.passwordForm,avatarChangeInput:this.props.avatarChangeInput,helper:this.props.helper,avatarChanger:this.props.avatarChanger})}constructor(t){super("div",{},{title:t.title,avatarChanger:new xe({name:"avatar",onchange:t=>{null==t||t.preventDefault();const{files:e}=null==t?void 0:t.target;if(!e||!e[0])return;const[s]=e;pe.updateAvatar(s)},avatarLink:Lt("")}),dataForm:new x({valid:!0,buttonText:"Изменить данные",fields:[{placeholder:"Имя",name:"first_name",type:"text",validFunc:t=>/^[А-ЯA-Z][а-яёЁa-z]+$/.test(t)},{placeholder:"Фамилия",name:"second_name",type:"text",validFunc:t=>/^[А-ЯA-Z][а-яёЁa-z]+$/.test(t)},{placeholder:"Логин",name:"login",type:"text",validFunc:t=>/^(?=.*[a-zA-Z_-])[a-zA-Z0-9-_]{3,20}$/.test(t)},{placeholder:"Отображаемый ник",name:"display_name",type:"text"},{placeholder:"Почта",name:"email",type:"text",validFunc:t=>/^(?=.*[a-zA-Z_@-])[a-zA-Z_@-]+@[a-zA-Z_-]+\.[a-zA-Z_-]+$/.test(t)},{placeholder:"Телефон",name:"phone",type:"text",validFunc:t=>/^[\d/+]\d{9,14}$/.test(t)}],submit:t=>{pe.updateProfile(t)}}),passwordForm:new x({valid:!0,buttonText:"Изменить Пароль",fields:[{placeholder:"Старый пароль",name:"oldPassword",type:"password"},{placeholder:"Новый пароль",name:"newPassword",type:"password",validFunc:t=>/^(?=.*[A-ZА-Я])(?=.*\d).{8,40}$/.test(t)}],submit:t=>{pe.updatePassword(t)}}),helper:t.helper})}};var Oe=class extends g{componentDidMount(){document.title="Настройки профиля",z.getProfile()}render(){return Te({form:this.props.regForm})}constructor(){super("div",{},{regForm:new De({title:"Изменение профиля",helper:new L({text:"",onclick:async()=>{await z.logout()},textLink:"Выйти"})})})}};var Ne=(t={chatSetting:!1,chatName:!1},e)=>{switch(e.type){case"popUp/SETCHATSETTINGACTIVE":return{...t,chatSetting:!0};case"popUp/SETCHATSETTINGDISABLE":return{...t,chatSetting:!1};case"popUp/SETCHATNAMEACTIVE":return{...t,chatName:!0};case"popUp/SETCHATNAMEDISABLE":return{...t,chatName:!1};case"popUp/CLOSEALL":return Object.keys(t).reduce(((t,e)=>({...t,[e]:!1})),{});default:return t}};var Re=(t=[],e)=>{switch(e.type){case"chats/SET":return e.payload;case"chats/SETMEMBERS":return t.map((t=>t.id===e.payload.chatId?{...t,members:e.payload.members}:{...t}));case"chats/ADDNEWMESSAGES":return t.map((t=>t.id===e.payload.chatId?{...t,messages:t.messages?e.payload.messages.concat(t.messages):e.payload.messages}:{...t}));case"chats/ADDOLDMESSAGES":return t.map((t=>t.id===e.payload.chatId?{...t,messages:t.messages?t.messages.concat(e.payload.messages):e.payload.messages}:{...t}));case"chats/SETCHATAVATAR":return t.map((t=>t.id===e.payload.chatId?{...t,avatar:e.payload.avatar}:{...t}));default:return t}};var Ue=(t={id:void 0},e)=>{switch(e.type){case"currentChat/SETACTIVECHATID":return{...t,activeChatId:e.payload};default:return t}};var Me=(t=[],e)=>{switch(e.type){case"searchUsers/SETUSERS":return e.payload;default:return t}};var $e=(t,e)=>{switch(e.type){case"profile/SET":return e.payload;default:return t}};var Be=(t={},e)=>{switch(e.type){case"errors/SETAUTH":return{...t,auth:e.payload};case"errors/SETREG":return{...t,reg:e.payload};case"errors/SETPROFILE":return{...t,profile:e.payload};case"errors/CLEARPROFILE":return{...t,profile:void 0};case"errors/SETPASSWORD":return{...t,password:e.payload};case"errors/CLEARPASSWORD":return{...t,password:void 0};default:return t}};var Ve=()=>{Z.addReducer("popUp",Ne).addReducer("chats",Re).addReducer("currentChat",Ue).addReducer("searchUsers",Me).addReducer("profile",$e).addReducer("errors",Be)};document.addEventListener("DOMContentLoaded",(()=>{!function(t){const e=document.querySelector(t);if(null===e)return;Ve(),new O(e).use("/",Ae).use("/auth/",et).use("/reg/",Q).use("/profile/",Oe).start()}(".root")}));
//# sourceMappingURL=404.09282a38.js.map
